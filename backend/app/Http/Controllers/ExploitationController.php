<?php

namespace App\Http\Controllers;

use App\Models\Exploitation;
use App\Http\Requests\StoreExploitationRequest;
use App\Http\Requests\UpdateExploitationRequest;
use Illuminate\Support\Facades\Gate;
use Illuminate\Http\Request;

class ExploitationController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        //

        // Gate::authorize("viewAny", $request->user());
        return Exploitation::all();
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        //
        //
        //  Gate::authorize("create", [$request->user()]);
        //

        

        $fields=$request->validate([
            // "produit_sante_id"=> 'required',
            // "type_exploitation"=> 'required',
            'produits_sante_exploites'=> 'required|array',
            'produits_sante_exploites.*.produit_sante_id'=> 'required',
            'produits_sante_exploites.*.type_exploitation'=> 'required',

        ]);

        foreach ($request->produits_sante_exploites as $produit_sante_exploite){
   
            $request->user()->exploitation()->create($produit_sante_exploite);

        }

        return "exploitation des differents produits de sante enregistrÃ©e ";
        // $notification=$request->user()->exploitation()->create($fields);
    }

    /**
     * Display the specified resource.
     */
    public function show(Exploitation $exploitation)
    {
        //
        // Gate::authorize("view", $exploitation);
        return $exploitation;
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, Exploitation $exploitation)
    {
        //
        // Gate::authorize("update", $exploitation);
        $fields=$request->validate([
            'produit_sante_id'=> 'required',
            'type_exploitation'=> 'required',

        ]);

        $exploitation->update($fields);

        return $exploitation;

    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(Exploitation $exploitation)
    {
        //
        // Gate::authorize("delete", $exploitation);
        $exploitation->delete();
    }
}
